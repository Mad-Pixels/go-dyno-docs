# Описание Входящей JSON-схемы
## Базовая структура
JSON схема состоит из шести основных разделов:
- `table_name` - имя DynamoDB таблицы
- `hash_key` и `range_key` - первичные ключи таблицы
- `attributes` - ключевые атрибуты для индексов
- `common_attributes` - обычные поля данных
- `secondary_indexes` - вторичные индексы (GSI/LSI)

## Примеры
::: code-group
<<< @/snippets/json_ref/basic{json}
<<< @/snippets/json_ref/range{json}
<<< @/snippets/json_ref/full{json}
<<< @/snippets/json_ref/subtypes{json}
<<< @/snippets/json_ref/composite{json}
:::

## Обязательные поля
### table_name
**Тип:** `string`  
**Обязательный:** Да

Логическое имя DynamoDB таблицы. Используется для генерации:
- Имени Go пакета (в нижнем регистре)
- Имени файла (table_name.go)
- Константы TableName в коде

Пример: `"user_profiles"` → пакет `userprofiles`, файл `userprofiles.go`

### hash_key
**Тип:** `string`  
**Обязательный:** Да

Первичный ключ раздела (partition key) DynamoDB таблицы. Должен ссылаться на один из атрибутов из массива `attributes`.

Пример: `"user_id"`

### attributes
**Тип:** `array of objects`  
**Обязательный:** Да

Массив ключевых атрибутов, которые могут использоваться в первичных ключах и индексах. Каждый атрибут содержит:

#### name
**Тип:** `string`  
**Обязательный:** Да

Имя атрибута. Должно быть уникальным в пределах всех атрибутов таблицы.

#### type
**Тип:** `string`  
**Обязательный:** Да

DynamoDB тип данных. Поддерживаемые значения:
| DynamoDB тип | Go тип | Описание |
|--------------|--------|-----------|
| `"S"` | `string` | Строка |
| `"N"` | `int64` | Число |
| `"BOOL"` | `bool` | Булево значение |
| `"SS"` | `[]string` | Множество строк |
| `"NS"` | `[]int` | Множество чисел |
| `"string"` | `string` | Алиас для "S" |
| `"number"` | `int64` | Алиас для "N" |
| `"boolean"` | `bool` | Алиас для "BOOL" |

Пример атрибута:
```json
{
  "name": "user_id",
  "type": "S"
}
```

## Опциональные поля

#### subtype
**Тип:** `string`  
**Обязательный:** Нет

Уточняет Go тип для числовых данных. Применимо только для типов `"N"` и `"NS"`:

| DynamoDB тип | Subtype | Go тип | Описание |
|--------------|---------|--------|-----------|
| `"N"` | `"int32"` | `int32` | 32-битное целое |
| `"N"` | `"int64"` | `int64` | 64-битное целое (по умолчанию) |
| `"N"` | `"float32"` | `float32` | 32-битное число с плавающей точкой |
| `"N"` | `"uint64"` | `uint64` | 64-битное беззнаковое целое |
| `"N"` | `"int16"` | `int16` | 16-битное целое |
| `"NS"` | `"int32"` | `[]int32` | Множество 32-битных целых |
| `"NS"` | `"int64"` | `[]int64` | Множество 64-битных целых |
| `"NS"` | `"float32"` | `[]float32` | Множество чисел с плавающей точкой |
| `"NS"` | `"uint64"` | `[]uint64` | Множество беззнаковых целых |
| `"NS"` | `"int16"` | `[]int16` | Множество 16-битных целых |

Пример с кастомным типом:
```json
{
  "name": "price",
  "type": "N",
  "subtype": "float32"
}
```

### range_key
**Тип:** `string`  
**Обязательный:** Нет

Первичный ключ сортировки (sort key) DynamoDB таблицы. Если указан, должен ссылаться на один из атрибутов из массива `attributes`.

Пример: `"timestamp"`

### common_attributes
**Тип:** `array of objects`  
**Обязательный:** Нет

Массив обычных атрибутов для хранения данных. Эти атрибуты НЕ могут использоваться в ключах индексов, только для хранения информации.
Структура объекта аналогична `attributes`:
```json
{
  "name": "email",
  "type": "string"
}
```

### secondary_indexes
**Тип:** `array of objects`  
**Обязательный:** Нет

Массив вторичных индексов (GSI и LSI) для расширенных возможностей запросов.

## Вторичные индексы

Каждый индекс в массиве `secondary_indexes` поддерживает следующие поля:

### name
**Тип:** `string`  
**Обязательный:** Да

Уникальное имя индекса в пределах таблицы.

### type
**Тип:** `string`  
**Обязательный:** Да  
**Значения:** `"GSI"` или `"LSI"`

Тип индекса:
- **GSI** (Global Secondary Index) - может иметь любой hash_key
- **LSI** (Local Secondary Index) - использует hash_key основной таблицы

### hash_key
**Тип:** `string`  
**Обязательный:** Для GSI - да, для LSI - нет

Ключ раздела для индекса:
- **GSI:** может быть любым атрибутом из `attributes`
- **LSI:** автоматически использует hash_key основной таблицы

### range_key
**Тип:** `string`  
**Обязательный:** Для LSI - да, для GSI - нет

Ключ сортировки для индекса. Должен ссылаться на атрибут из `attributes` и отличаться от range_key основной таблицы (для LSI).

### projection_type
**Тип:** `string`  
**Обязательный:** Да  
**Значения:** `"ALL"`, `"KEYS_ONLY"`, `"INCLUDE"`

Определяет, какие атрибуты включены в индекс:

- **ALL** - все атрибуты основной таблицы
- **KEYS_ONLY** - только ключевые атрибуты индекса и таблицы
- **INCLUDE** - ключи + атрибуты из `non_key_attributes`

### non_key_attributes
**Тип:** `array of strings`  
**Обязательный:** Только когда `projection_type` = `"INCLUDE"`

Список дополнительных атрибутов для включения в индекс при `projection_type: "INCLUDE"`.

### read_capacity и write_capacity
**Тип:** `integer`  
**Обязательный:** Нет  
**Только для:** GSI

Настройки пропускной способности для GSI. LSI использует настройки основной таблицы.

## Композитные ключи
```json
{
  "name": "user_status_index",
  "type": "GSI",
  "hash_key": "user_id#status",
  "range_key": "created_at"
}
```
Композитный ключ `user_id#status` создает ключ из комбинации атрибутов `user_id` и `status`.

## Валидация

go-dyno автоматически проверяет:

- Все ключи ссылаются на существующие атрибуты
- Уникальность имен индексов
- Корректность типов проекции
- Соответствие `non_key_attributes` типу проекции `INCLUDE`
- LSI имеет обязательный `range_key`
- GSI имеет обязательный `hash_key`
- Range key LSI отличается от range key таблицы

При ошибках валидации генерация кода завершится с детальным описанием проблемы.

## Генерируемый код

Из JSON схемы go-dyno создает:

- **Константы:** `TableName`, имена атрибутов, имена индексов
- **Структуры:** `SchemaItem` с правильными Go типами и AWS тегами
- **Query Builder:** типобезопасные методы для запросов
- **Scan Builder:** методы для полнотабличного поиска
- **CRUD методы:** `ItemInput()`, `KeyInput()`, `UpdateItemInput()` и другие
- **Схема метаданных:** `TableSchema` с информацией о полях и индексах

Все сгенерированные методы используют типобезопасность Go и автоматически выбирают оптимальные индексы для запросов.