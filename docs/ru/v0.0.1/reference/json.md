# Описание JSON-схемы
## Базовая структура
JSON схема состоит из нескольких разделов:
1. `table_name` - имя DynamoDB таблицы
2. `hash_key` / `range_key` - первичные ключи таблицы
3. `attributes` - ключевые атрибуты для индексов
4. `common_attributes` - обычные поля данных
5. `secondary_indexes` - вторичные индексы (GSI/LSI)

## Примеры
::: code-group
<<< @/snippets/v0.0.1/ref_json/basic.json{json}
<<< @/snippets/v0.0.1/ref_json/full.json{json}
<<< @/snippets/v0.0.1/ref_json/overwrite_subtypes.json{json}
<<< @/snippets/v0.0.1/ref_json/composite_keys.json{json}
:::

## Обязательные поля
### `table_name`
> **Тип:** `string`  
> **Пример:** `"user_profiles"` 
::: info Логическое имя DynamoDB таблицы. 
Используется для генерации:
- Имени Go пакета (в нижнем регистре)
- Имени файла (table_name.go)
- Константы TableName в коде
:::
::: warning пакет `userprofiles`, файл `userprofiles.go`
:::

<br>

### `hash_key`
> **Тип:** `string`  
> **Пример:** `"user_id"`
::: info Первичный ключ раздела (partition key) DynamoDB таблицы.
Должен ссылаться на один из атрибутов из массива `attributes`.
:::

<br>

### `attributes`
> **Тип:** `array of objects`  
> **Пример:** `{"name": "user_id", "type": "S"}`
::: info Массив ключевых атрибутов
Используются в первичных ключах и индексах.
:::

#### Состоит из:
- `name`
  > **Тип:** `string`
  > **Пример:** `"user_id"`
  ::: info Имя атрибута
  Должно быть уникальным в пределах всех атрибутов таблицы.
  :::
- `type`
  > **Тип:** `string`  
  > **Пример:** `"S"`
  ::: info DynamoDB тип данных
  | DynamoDB тип | Go тип | Описание |
  |--------------|--------|-----------|
  | `"S"` | `string` | Строка |
  | `"N"` | `int64` | Число |
  | `"BOOL"` | `bool` | Булево значение |
  | `"SS"` | `[]string` | Множество строк |
  | `"NS"` | `[]int` | Множество чисел |
  | `"string"` | `string` | Алиас для "S" |
  | `"number"` | `int64` | Алиас для "N" |
  | `"boolean"` | `bool` | Алиас для "BOOL" |
  :::
- `subtype`
  > **Тип:** `string` _(опциональное поле)_
  > **Пример:** `"uint64"`
  ::: info Уточняет Go тип
  _Применимо только для типов `"N"` и `"NS"`_

  | DynamoDB тип | Subtype | Go тип | Описание |
  |--------------|---------|--------|-----------|
  | `"N"` | `"int32"` | `int32` | 32-битное целое |
  | `"N"` | `"int64"` | `int64` | 64-битное целое (по умолчанию) |
  | `"N"` | `"float32"` | `float32` | 32-битное число с плавающей точкой |
  | `"N"` | `"uint64"` | `uint64` | 64-битное беззнаковое целое |
  | `"N"` | `"int16"` | `int16` | 16-битное целое |
  | `"NS"` | `"int32"` | `[]int32` | Множество 32-битных целых |
  | `"NS"` | `"int64"` | `[]int64` | Множество 64-битных целых |
  | `"NS"` | `"float32"` | `[]float32` | Множество чисел с плавающей точкой |
  | `"NS"` | `"uint64"` | `[]uint64` | Множество беззнаковых целых |
  | `"NS"` | `"int16"` | `[]int16` | Множество 16-битных целых |
  :::

## Опциональные поля
### `range_key`
> **Тип:** `string`  
> **Пример:** `"timestamp"`
::: info Первичный ключ сортировки (sort key) DynamoDB таблицы.
Если указан, должен ссылаться на один из атрибутов из массива `attributes`.
:::

<br>

### `common_attributes`
> **Тип:** `array of objects`  
> **Пример:** `{"name": "email", "type": "S"}`
::: info Массив обычных атрибутов для хранения данных.
Эти атрибуты НЕ могут использоваться в ключах индексов, только для хранения информации.
::: 
::: warning Структура объекта аналогична `attributes`
:::

<br>

### `secondary_indexes`
> **Тип:** `array of objects`  
::: info Массив вторичных индексов (`GSI` и `LSI`) для расширенных возможностей запросов.
:::
#### Состоит из:
- `name`
  > **Тип:** `string`  
  > **Пример:** `"user_id"`
  ::: info Имя атрибута
  Уникальное имя индекса в пределах таблицы.
  :::
- `type`
  > **Тип:** `string`  
  > **Пример:** `"GSI"`
  ::: info Тип индекса
  - **GSI** (Global Secondary Index) - может иметь любой hash_key
  - **LSI** (Local Secondary Index) - использует hash_key основной таблицы
  :::
- `hash_key`
  > **Тип:** `string`  
  > **Обязательный:** Для GSI - да, для LSI - нет
  ::: info Ключ сортировки для индекса
  Должен ссылаться на атрибут из `attributes` и отличаться от range_key основной таблицы (для LSI).
  :::
- `projection_type`
  > **Тип:** `string`  
  > **Значения:** `"ALL"`, `"KEYS_ONLY"`, `"INCLUDE"`
  ::: info Определяет, какие атрибуты включены в индекс
  - **ALL** - все атрибуты основной таблицы
  - **KEYS_ONLY** - только ключевые атрибуты индекса и таблицы
  - **INCLUDE** - ключи + атрибуты из `non_key_attributes`
  :::
- `non_key_attributes`
  > **Тип:** `array of strings`  
  > **Обязательный:** Только когда `projection_type` = `"INCLUDE"`
  ::: info Список дополнительных атрибутов для включения в индекс
  :::
- `read_capacity` и `write_capacity`
  > **Тип:** `integer`  
  > **Обязательный:** Нет  
  ::: info Настройки пропускной способности для GSI
  _LSI использует настройки основной таблицы._
  :::
  ::: warning **Только для:** GSI 
  :::

## Композитные ключи
```json
{
  "name": "user_status_index",
  "type": "GSI",
  "hash_key": "user_id#status",
  "range_key": "created_at"
}
```
::: warning Композитный ключ `user_id#status` создает ключ из комбинации атрибутов `user_id` и `status`.
:::

## Валидация
GoDyno автоматически проверяет:
- Все ключи ссылаются на существующие атрибуты
- Уникальность имен индексов
- Корректность типов проекции
- Соответствие `non_key_attributes` типу проекции `INCLUDE`
- LSI имеет обязательный `range_key`
- GSI имеет обязательный `hash_key`
- Range key LSI отличается от range key таблицы
::: info При ошибках валидации генерация кода завершится с детальным описанием проблемы.
:::
